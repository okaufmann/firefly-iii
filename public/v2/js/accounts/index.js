(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{333:function(t,e,a){t.exports=a(458)},458:function(t,e,a){"use strict";a.r(e);var n=a(8),i=a.n(n),s=a(14),r=a(267);function o(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function c(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?o(Object(a),!0).forEach((function(e){l(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function l(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}var d={name:"Index",props:{accountTypes:String},data:function(){return{accounts:[],allAccounts:[],type:"all",downloaded:!1,loading:!1,ready:!1,fields:[],currentPage:1,perPage:5,total:0,sortBy:"order",sortDesc:!1,sortableOptions:{disabled:!1,chosenClass:"is-selected",onEnd:null},sortable:null}},watch:{storeReady:function(){this.getAccountList()},start:function(){this.getAccountList()},end:function(){this.getAccountList()},orderMode:function(t){this.updateFieldList(),this.reorderAccountList(t),this.makeTableSortable(t)},activeFilter:function(t){this.filterAccountList()}},computed:c(c(c(c({},Object(s.d)("root",["listPageSize"])),Object(s.d)("accounts/index",["orderMode","activeFilter"])),Object(s.d)("dashboard/index",["start","end"])),{},{indexReady:function(){return null!==this.start&&null!==this.end&&null!==this.listPageSize&&this.ready},cardTitle:function(){return this.$t("firefly."+this.type+"_accounts")}}),created:function(){var t=window.location.pathname.split("/");this.type=t[t.length-1];var e=new URLSearchParams(window.location.search);this.currentPage=e.get("page")?parseInt(e.get("page")):1,this.updateFieldList(),this.ready=!0},methods:{saveAccountSort:function(t){var e=this,a=parseInt(t.oldIndex),n=parseInt(t.newIndex),i=parseInt(t.item.attributes.getNamedItem("data-pk").value);for(var s in this.accounts)if(this.accounts.hasOwnProperty(s)&&/^0$|^[1-9]\d*$/.test(s)&&s<=4294967294){var r=this.accounts[s];if(r.id===i){var o=parseInt(r.order)+(n-a);this.accounts[s].order=o;var c="./api/v1/accounts/"+r.id;axios.put(c,{order:o}).then((function(t){e.getAccountList()}))}}},reorderAccountList:function(t){t&&(this.sortBy="order",this.sortDesc=!1)},makeTableSortable:function(t){this.sortableOptions.disabled=!t,this.sortableOptions.onEnd=this.saveAccountSort,null===this.sortable&&(this.sortable=r.a.create(this.$refs.table.$el.querySelector("tbody"),this.sortableOptions)),this.sortable.option("disabled",this.sortableOptions.disabled)},updateFieldList:function(){this.fields=[],this.fields=[{key:"title",label:this.$t("list.name"),sortable:!this.orderMode}],"asset"===this.type&&this.fields.push({key:"role",label:this.$t("list.role"),sortable:!this.orderMode}),this.fields.push({key:"number",label:this.$t("list.iban"),sortable:!this.orderMode}),this.fields.push({key:"current_balance",label:this.$t("list.currentBalance"),sortable:!this.orderMode}),this.fields.push({key:"menu",label:" ",sortable:!1})},getAccountList:function(){var t;(console.log("getAccountList()"),!this.indexReady||this.loading||this.downloaded)||(console.log("Index ready, not loading and not already downloaded. Reset."),this.loading=!0,this.perPage=null!==(t=this.listPageSize)&&void 0!==t?t:51,this.accounts=[],this.allAccounts=[],this.downloadAccountList(1));this.indexReady&&!this.loading&&this.downloaded&&(console.log("Index ready, not loading and not downloaded."),this.loading=!0,this.filterAccountList())},downloadAccountList:function(t){var e=this;console.log("downloadAccountList("+t+")"),axios.get("./api/v1/accounts?type="+this.type+"&page="+t).then((function(t){var a=parseInt(t.data.meta.pagination.current_page),n=parseInt(t.data.meta.pagination.total_pages);if(e.total=parseInt(t.data.meta.pagination.total),e.parseAccounts(t.data.data),a<n){var i=a+1;e.downloadAccountList(i)}a>=n&&(console.log("Looks like all downloaded."),e.downloaded=!0,e.filterAccountList())}))},filterAccountList:function(){for(var t in console.log("filterAccountList()"),this.accounts=[],this.allAccounts)if(this.allAccounts.hasOwnProperty(t)&&/^0$|^[1-9]\d*$/.test(t)&&t<=4294967294){if(1===this.activeFilter&&!1===this.allAccounts[t].active){console.log("Skip account #"+this.allAccounts[t].id+" because not active.");continue}if(2===this.activeFilter&&!0===this.allAccounts[t].active){console.log("Skip account #"+this.allAccounts[t].id+" because active.");continue}console.log("Include account #"+this.allAccounts[t].id+"."),this.accounts.push(this.allAccounts[t])}this.total=this.accounts.length,this.loading=!1},roleTranslate:function(t){return null===t?"":this.$t("firefly.account_role_"+t)},parsePages:function(t){this.total=parseInt(t.pagination.total)},parseAccounts:function(t){for(var e in console.log("In parseAccounts()"),t)if(t.hasOwnProperty(e)&&/^0$|^[1-9]\d*$/.test(e)&&e<=4294967294){var a=t[e],n={};n.id=parseInt(a.id),n.order=a.attributes.order,n.title=a.attributes.name,n.active=a.attributes.active,n.role=this.roleTranslate(a.attributes.account_role),n.account_number=a.attributes.account_number,n.current_balance=a.attributes.current_balance,n.currency_code=a.attributes.currency_code,n.balance_diff="loading",null!==a.attributes.iban&&(n.iban=a.attributes.iban.match(/.{1,4}/g).join(" ")),this.allAccounts.push(n),"asset"===this.type&&this.getAccountBalanceDifference(this.allAccounts.length-1,a)}},getAccountBalanceDifference:function(t,e){var a=this;console.log("getAccountBalanceDifference("+t+")");var n=[];n.push(new Promise((function(a){a({account:e,index:t})}))),n.push(axios.get("./api/v1/accounts/"+e.id+"?date="+this.start.toISOString().split("T")[0])),n.push(axios.get("./api/v1/accounts/"+e.id+"?date="+this.end.toISOString().split("T")[0])),Promise.all(n).then((function(t){var e=t[0].index,n=parseFloat(t[1].data.data.attributes.current_balance),i=parseFloat(t[2].data.data.attributes.current_balance);a.allAccounts[e].balance_diff=i-n}))}}},u=a(4),p=Object(u.a)(d,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"row"},[a("div",{staticClass:"col-lg-12 col-md-12 col-sm-12 col-xs-12"},[a("b-pagination",{attrs:{"total-rows":t.total,"per-page":t.perPage,"aria-controls":"my-table"},model:{value:t.currentPage,callback:function(e){t.currentPage=e},expression:"currentPage"}})],1)]),t._v(" "),a("div",{staticClass:"row"},[a("div",{staticClass:"col-lg-12 col-md-12 col-sm-12 col-xs-12"},[a("div",{staticClass:"card"},[a("div",{staticClass:"card-header"}),t._v(" "),a("div",{staticClass:"card-body p-0"},[a("b-table",{ref:"table",attrs:{id:"my-table",striped:"",hover:"","primary-key":"id",items:t.accounts,fields:t.fields,"per-page":t.perPage,"sort-icon-left":"","current-page":t.currentPage,busy:t.loading,"sort-by":t.sortBy,"sort-desc":t.sortDesc},on:{"update:busy":function(e){t.loading=e},"update:sortBy":function(e){t.sortBy=e},"update:sort-by":function(e){t.sortBy=e},"update:sortDesc":function(e){t.sortDesc=e},"update:sort-desc":function(e){t.sortDesc=e}},scopedSlots:t._u([{key:"cell(title)",fn:function(e){return[a("a",{attrs:{href:"./accounts/show/"+e.item.id,title:e.value}},[t._v(t._s(e.value))])]}},{key:"cell(number)",fn:function(e){return[null!==e.item.iban&&null===e.item.account_number?a("span",[t._v(t._s(e.item.iban))]):t._e(),t._v(" "),null===e.item.iban&&null!==e.item.account_number?a("span",[t._v(t._s(e.item.account_number))]):t._e(),t._v(" "),null!==e.item.iban&&null!==e.item.account_number?a("span",[t._v(t._s(e.item.iban)+" ("+t._s(e.item.account_number)+")")]):t._e()]}},{key:"cell(current_balance)",fn:function(e){return[parseFloat(e.item.current_balance)>0?a("span",{staticClass:"text-success"},[t._v("\n                "+t._s(Intl.NumberFormat("en-US",{style:"currency",currency:e.item.currency_code}).format(e.item.current_balance))+"\n              ")]):t._e(),t._v(" "),parseFloat(e.item.current_balance)<0?a("span",{staticClass:"text-danger"},[t._v("\n                "+t._s(Intl.NumberFormat("en-US",{style:"currency",currency:e.item.currency_code}).format(e.item.current_balance))+"\n              ")]):t._e(),t._v(" "),0===parseFloat(e.item.current_balance)?a("span",{staticClass:"text-muted"},[t._v("\n                "+t._s(Intl.NumberFormat("en-US",{style:"currency",currency:e.item.currency_code}).format(e.item.current_balance))+"\n              ")]):t._e(),t._v(" "),"asset"===t.type&&"loading"===e.item.balance_diff?a("span",[a("i",{staticClass:"fas fa-spinner fa-spin"})]):t._e(),t._v(" "),"asset"===t.type&&"loading"!==e.item.balance_diff?a("span",[t._v("\n                 ("),parseFloat(e.item.balance_diff)>0?a("span",{staticClass:"text-success"},[t._v(t._s(Intl.NumberFormat("en-US",{style:"currency",currency:e.item.currency_code}).format(e.item.balance_diff)))]):t._e(),0===parseFloat(e.item.balance_diff)?a("span",{staticClass:"text-muted"},[t._v(t._s(Intl.NumberFormat("en-US",{style:"currency",currency:e.item.currency_code}).format(e.item.balance_diff)))]):t._e(),parseFloat(e.item.balance_diff)<0?a("span",{staticClass:"text-danger"},[t._v(t._s(Intl.NumberFormat("en-US",{style:"currency",currency:e.item.currency_code}).format(e.item.balance_diff)))]):t._e(),t._v(")\n              ")]):t._e()]}},{key:"cell(menu)",fn:function(e){return[a("div",{staticClass:"btn-group btn-group-sm"},[a("div",{staticClass:"dropdown"},[a("button",{staticClass:"btn btn-light btn-sm dropdown-toggle",attrs:{type:"button",id:"dropdownMenuButton"+e.item.id,"data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"}},[t._v("\n                    "+t._s(t.$t("firefly.actions"))+"\n                  ")]),t._v(" "),a("div",{staticClass:"dropdown-menu",attrs:{"aria-labelledby":"dropdownMenuButton"+e.item.id}},[a("a",{staticClass:"dropdown-item",attrs:{href:"./accounts/edit/"+e.item.id}},[a("i",{staticClass:"fa fas fa-pencil-alt"}),t._v(" "+t._s(t.$t("firefly.edit")))]),t._v(" "),a("a",{staticClass:"dropdown-item",attrs:{href:"./accounts/delete/"+e.item.id}},[a("i",{staticClass:"fa far fa-trash"}),t._v(" "+t._s(t.$t("firefly.delete")))]),t._v(" "),"asset"===t.type?a("a",{staticClass:"dropdown-item",attrs:{href:"./accounts/reconcile/"+e.item.id}},[a("i",{staticClass:"fas fa-check"}),t._v("\n                      "+t._s(t.$t("firefly.reconcile_this_account")))]):t._e()])])])]}}])})],1),t._v(" "),a("div",{staticClass:"card-footer"},[a("a",{staticClass:"btn btn-success",attrs:{href:"./accounts/create/"+t.type,title:t.$t("firefly.create_new_"+t.type)}},[t._v(t._s(t.$t("firefly.create_new_"+t.type)))])])])])])])}),[],!1,null,"2a610ab2",null).exports,f=a(30),h=a(465),b=a(466),m=a(67),v={name:"IndexOptions",data:function(){return{type:"invalid"}},computed:{orderMode:{get:function(){return this.$store.getters["accounts/index/orderMode"]},set:function(t){this.$store.commit("accounts/index/setOrderMode",t),!0===t&&this.$store.commit("accounts/index/setActiveFilter",1)}},activeFilter:{get:function(){return this.$store.getters["accounts/index/activeFilter"]},set:function(t){this.$store.commit("accounts/index/setActiveFilter",parseInt(t))}}},created:function(){var t=window.location.pathname.split("/");this.type=t[t.length-1]}},_=Object(u.a)(v,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"form-check"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.orderMode,expression:"orderMode"}],staticClass:"form-check-input",attrs:{type:"checkbox",name:"order_mode",id:"order_mode"},domProps:{checked:Array.isArray(t.orderMode)?t._i(t.orderMode,null)>-1:t.orderMode},on:{change:function(e){var a=t.orderMode,n=e.target,i=!!n.checked;if(Array.isArray(a)){var s=t._i(a,null);n.checked?s<0&&(t.orderMode=a.concat([null])):s>-1&&(t.orderMode=a.slice(0,s).concat(a.slice(s+1)))}else t.orderMode=i}}}),t._v(" "),a("label",{staticClass:"form-check-label",attrs:{for:"order_mode"}},[t._v("\n      Enable order mode\n    ")])]),t._v(" "),a("div",{staticClass:"form-check"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.activeFilter,expression:"activeFilter"}],staticClass:"form-check-input",attrs:{disabled:t.orderMode,type:"radio",value:"1",id:"active_filter_1"},domProps:{checked:t._q(t.activeFilter,"1")},on:{change:function(e){t.activeFilter="1"}}}),t._v(" "),a("label",{staticClass:"form-check-label",attrs:{for:"active_filter_1"}},[t._v("\n      Show active accounts\n    ")])]),t._v(" "),a("div",{staticClass:"form-check"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.activeFilter,expression:"activeFilter"}],staticClass:"form-check-input",attrs:{disabled:t.orderMode,type:"radio",value:"2",id:"active_filter_2"},domProps:{checked:t._q(t.activeFilter,"2")},on:{change:function(e){t.activeFilter="2"}}}),t._v(" "),a("label",{staticClass:"form-check-label",attrs:{for:"active_filter_2"}},[t._v("\n      Show inactive accounts\n    ")])]),t._v(" "),a("div",{staticClass:"form-check"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.activeFilter,expression:"activeFilter"}],staticClass:"form-check-input",attrs:{disabled:t.orderMode,type:"radio",value:"3",id:"active_filter_3"},domProps:{checked:t._q(t.activeFilter,"3")},on:{change:function(e){t.activeFilter="3"}}}),t._v(" "),a("label",{staticClass:"form-check-label",attrs:{for:"active_filter_3"}},[t._v("\n      Show both\n    ")])])])}),[],!1,null,"b354f694",null).exports;a(41);var y=a(43),g={};i.a.component("b-table",h.a),i.a.component("b-pagination",b.a),new i.a({i18n:y,store:f.a,el:"#accounts",render:function(t){return t(p,{props:g})},beforeCreate:function(){this.$store.commit("initialiseStore"),this.$store.dispatch("updateCurrencyPreference"),this.$store.dispatch("root/initialiseStore"),this.$store.dispatch("dashboard/index/initialiseStore")}}),new i.a({i18n:y,store:f.a,el:"#calendar",render:function(t){return t(m.a,{props:g})}}),new i.a({i18n:y,store:f.a,el:"#indexOptions",render:function(t){return t(_,{props:g})}})}},[[333,0,1]]]);
//# sourceMappingURL=index.js.map